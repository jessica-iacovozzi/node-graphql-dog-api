name: Seed Production Database

on:
  workflow_dispatch:  # Manual trigger from GitHub UI

jobs:
  seed:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Check environment variables
        run: |
          echo "Checking if DATABASE_URL is set ..."
          if [ -z "$DATABASE_URL" ]; then echo "ERROR: DATABASE_URL is empty"; else echo "DATABASE_URL is set"; fi
          echo "Checking if DIRECT_URL is set ..."
          if [ -z "$DIRECT_URL" ]; then echo "ERROR: DIRECT_URL is empty"; else echo "DIRECT_URL is set"; fi
          # Check if they start with postgresql:// (without showing actual values)
          if [[ "$DATABASE_URL" == postgresql://* ]]; then echo "DATABASE_URL format looks correct"; else echo "ERROR: DATABASE_URL should start with postgresql://"; fi
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          DIRECT_URL: ${{ secrets.DIRECT_URL }}
      
      - name: Run seed script
        run: npx prisma db seed
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          DIRECT_URL: ${{ secrets.DIRECT_URL }}